services:
  tgin_webhook:
    build: 
      context: ../../
      dockerfile: Dockerfile
    volumes:
      - ./cfgs/webhook.ron:/etc/tgin/config.ron
    depends_on:
      - webhook_bot1
      - webhook_bot2
    networks:
      testing_net:
        ipv4_address: 10.5.0.2 

  tgin_longpull:
    build: 
      context: ../../
      dockerfile: Dockerfile
    volumes:
      - ./cfgs/longpull.ron:/etc/tgin/config.ron
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090/bot123:test/getUpdates
    depends_on:
      - longpull_bot1
      - longpull_bot2
    networks:
      testing_net:
        ipv4_address: 10.5.0.21

  bench:
    build: ./benchmark
    command: tail -f /dev/null
    networks:
      testing_net:
        ipv4_address: 10.5.0.3

  webhook_bot1:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - WEBHOOK_PATH=/webhook
      - PORT=8080
    networks:
      testing_net:
        ipv4_address: 10.5.0.11

  webhook_bot2:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - WEBHOOK_PATH=/webhook
      - PORT=8080
    networks:
      testing_net:
        ipv4_address: 10.5.0.12 

  webhook_bot3:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - WEBHOOK_PATH=/webhook
      - PORT=8080
    networks:
      testing_net:
        ipv4_address: 10.5.0.13

  webhook_bot4:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - WEBHOOK_PATH=/webhook
      - PORT=8080
    networks:
      testing_net:
        ipv4_address: 10.5.0.14

  webhook_bot5:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - WEBHOOK_PATH=/webhook
      - PORT=8080
    networks:
      testing_net:
        ipv4_address: 10.5.0.15

  longpull_bot_direct:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - TGIN_ENDPOINT=http://10.5.0.3:8090/bot123:test/getUpdates
    volumes:
      - ./bot/longpull.py:/app/bot.py
    depends_on:
      - bench
    networks:
      testing_net:
        ipv4_address: 10.5.0.20

  longpull_bot1:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - TGIN_ENDPOINT=http://10.5.0.21:3030/bot1/getUpdates
    volumes:
      - ./bot/longpull.py:/app/bot.py
    networks:
      testing_net:
        ipv4_address: 10.5.0.23

  longpull_bot2:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - TGIN_ENDPOINT=http://10.5.0.21:3030/bot2/getUpdates
    volumes:
      - ./bot/longpull.py:/app/bot.py
    networks:
      testing_net:
        ipv4_address: 10.5.0.22

  longpull_bot3:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - TGIN_ENDPOINT=http://10.5.0.21:3030/bot3/getUpdates
    volumes:
      - ./bot/longpull.py:/app/bot.py
    networks:
      testing_net:
        ipv4_address: 10.5.0.24

  longpull_bot4:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - TGIN_ENDPOINT=http://10.5.0.21:3030/bot4/getUpdates
    volumes:
      - ./bot/longpull.py:/app/bot.py
    networks:
      testing_net:
        ipv4_address: 10.5.0.25

  longpull_bot5:
    build: ./bot
    environment:
      - TELEGRAM_API_URL=http://10.5.0.3:8090
      - TGIN_ENDPOINT=http://10.5.0.21:3030/bot5/getUpdates
    volumes:
      - ./bot/longpull.py:/app/bot.py
    networks:
      testing_net:
        ipv4_address: 10.5.0.26

networks:
  testing_net:
    driver: bridge
    ipam:
      config:
        - subnet: 10.5.0.0/16